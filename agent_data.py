from flask import url_for
import os

def get_agents_data():
    """Возвращает список всех агентов с их метаданными."""
    return [
        {
            "id": "basic_tender",
            "name": "Анализ тендеров",
            "tags": ["тендеры", "анализ"],
            "image_url": None,  # будет заполнено позже через url_for
            "description": "Оценивает целесообразность участия в тендере и делает первичный анализ.",
            "action_url": os.getenv('BASIC_TENDER_URL'),
            "detail_url": "/basic_tender",
            "features": [
                "Оценка по целесообразности участия",
                "Проверка надёжности заказчика",
                "Интеграция с битрикс (в разработке)"
            ],
            "use_cases": [
                "Быстрое отсеивание неподходящих тендеров",
                "Быстрая оценка рисков участия",
                "Подготовка обоснования для руководства",
                "Первичный анализ тендера",
            ],
            "long_description": (
                "<p>Агент использует LLM и правила на основе опыта участия в тендерах. </p>"
                "<p>Оценка тендера проводится на по критериям: соответствие профилю компании, "
                "регион исполнения, цена и юридическая информация о заказчике из ЕГРЮЛ</p>"
            ),
            "image_filename": "images/image.png"
        },
        {
            "id": "data_extraction",
            "name": "Анализ ТЗ",
            "tags": ["тендеры", "ТЗ", "Анализ"],
            "image_url": None,
            "description": "Извлекает ключевую информацию из технического задания",
            "action_url": os.getenv('DATA_EXTRACTION_URL'),
            "detail_url": "/data_extraction",
            "features": [
                "Классификация тендеров",
                "Выделение сроков из ТЗ",
                "Выделение требований к подрядчику"
            ],
            "use_cases": [
                "Быстрое отсеивание неподходящих тендеров",
                "Быстрая оценка рисков участия",
                "Подготовка обоснования для руководства",
                "Первичный анализ тендера",
            ],
            "long_description": (
                "<p>Агент использует LLM и умный поиск по большому документу</p>"
                "<p>Пока работает только с pdf. Извлекает из документации: тип тендера, сроки, "
                "ключевые этапы работы, требования по наличию лицензий и разрешений у подрядчика</p>"
            ),
            "image_filename": "images/image1.png"
        },
        {
            "id": "meeting_analyzer",
            "name": "Анализ встреч",
            "tags": ["встречи", "транскрибация", "суммаризация", "задачи"],
            "image_url": None,
            "description": "Преобразует аудио встреч в текст, выделяет ключевые моменты и формирует задачи.",
            "action_url": os.getenv('MEETING_ANALYZER_URL'),
            "detail_url": "/meeting_analyzer",
            "features": [
                "Автоматическая транскрибация речи (включая русский язык)",
                "Интеллектуальная суммаризация по темам и решениям",
                "Формирование списка задач с ответственными и дедлайнами"
            ],
            "use_cases": [
                "Обработка записей совещаний без ручного конспектирования",
                "Контроль выполнения решений после встреч",
                "Быстрая передача контекста коллегам, не участвовавшим во встрече",
                "Архивирование обсуждений с возможностью поиска по содержанию"
            ],
            "long_description": (
                "<p>Агент принимает аудиозапись встречи и автоматически создаёт структурированный отчёт. "
                "Сначала выполняется транскрибация с поддержкой русской речи, затем — семантический анализ: "
                "выделяются обсуждённые темы, принятые решения и явно или косвенно сформулированные задачи. "
                "Результат включает краткое резюме, полную расшифровку и интерактивный список задач, готовый к интеграции в трекеры.</p>"
            ),
            "image_filename": "images/image2.png"
        },
        {
            "id": "document_qa",
            "name": "Поиск по документам",
            "tags": ["PDF", "вопросы по документам", "извлечение информации", "анализ текста"],
            "image_url": None,
            "description": "Загружаете PDF-документы — задаёте вопросы, а система ищет ответы прямо в них.",
            "action_url": os.getenv('DOCUMENT_QA_URL'),
            "detail_url": "/document_qa",
            "features": [
                "Поддержка текстовых PDF-файлов",
                "Понимание вопросов на естественном языке",
                "Точные ответы с опорой на загруженные документы",
            ],
            "use_cases": [
                "Быстрый поиск информации в большом архиве",
                "Ответы на вопросы по внутренним инструкциям без ручного поиска",
                "Подготовка выписок из нормативных или проектных документов"
            ],
            "long_description": (
                "<p>Загрузите папку с PDF-документами — и задавайте любые вопросы по их содержанию. "
                "Система автоматически проанализирует весь текст, найдёт релевантные фрагменты и даст чёткий ответ."
                "Работает, только для текстовых PDF. "
                "Идеально для работы с технической документацией, договорами, регламентами и отчётами.</p>"
            ),
            "image_filename": "images/image3.png"
        }
    ]

def enrich_agents_with_urls(agents, app_context):
    """Добавляет image_url и другие URL-поля, требующие контекста Flask."""
    with app_context:
        for agent in agents:
            agent["image_url"] = url_for('static', filename=agent["image_filename"])
            # Можно добавить другие url_for-ссылки при необходимости
    return agents

def get_navigation_agents():
    """Возвращает минимальные данные для навигации: имя и detail_url."""
    return [
        {"name": agent["name"], "detail_url": agent["detail_url"]}
        for agent in get_agents_data()
    ]